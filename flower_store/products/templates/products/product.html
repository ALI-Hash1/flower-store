{% extends 'base.html' %}

{% block content %}

    <h2>{{product.name}}</h2>
    <p> {{product.description}} </p>

    {% if request.user.is_authenticated %}
        <form action="" method="post">
            {% csrf_token %}
            {{form.as_p}}
            <input type="submit" value="Send">
        </form>
    {% else %}
        <p class="alert alert-danger"> Only logged in users can comment</p>
    {% endif %}
    <br><hr><br>
    {% for comment in comments %}
        {% if comment.admin_confirmation %}
            <h4>{{comment.author_name}}</h4>
            <p> {{comment.comment_text}} </p>
            <br>
            {% if request.user.is_authenticated %}
                <form action="{% url 'products:reply_comments' product.id comment.id %}" method="post">
                    {% csrf_token %}
                    {{form.as_p}}
                    <input type="submit" value="Send">
                </form>
            {% endif %}
            {% with replies=comment.answers_comment.all %}
                {% for reply in replies %}
                    {% if reply.admin_confirmation %}
                        <p class="bg-primary p-3 m-2"> {{reply.user}} <br>{{reply.comment_text}}</p>
                    {% endif %}
                {% endfor %}
            {% endwith %}
            <br><br>
        {% endif %}
    {% endfor %}

{% endblock content %}